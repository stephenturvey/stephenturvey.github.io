function mc_get_group_mincredits(n){return mc_groups[n][0]}function mc_get_stud_credits(n){return mc_groups[n][1]}function mc_get_calc_credits(n){return mc_groups[n][2]}function mc_set_calc_credits(n,t){mc_groups[n][2]=t}function mc_get_group_num(n){return mc_groups[n][3]}function mc_get_group_modules(n){return mc_groups[n][4]}function mc_get_group_exclusions(n){return mc_groups[n][5]}function mc_get_pres_code(n){return n[0]}function mc_get_pres_status(n){return n[1]}function mc_set_pres_status(n,t){n[1]=t}function mc_get_pres_yearstart(n){return n[2]}function mc_get_pres_studyyears(n){return n[3]}function mc_init(){mc_module_qualpath?(mc_img_select.src="img/select-bg.jpg",mc_img_tick.src="img/tick.png"):(mc_img_select.src="../img/select-on.gif",mc_img_unselect.src="../img/select-off.gif",mc_img_tick.src="../img/tick.gif"),mc_module_qualpath&&mc_warm_ajax(),mc_rehydrate(),mc_refresh_button_states(),mc_basket_misc()}function mc_get_active_group(){for(var n=0;n<mc_groups.length;n++)if(mc_get_calc_credits(n)<mc_get_group_mincredits(n))return n;return 999}function mc_refresh_button_states(){try{mc_refresh_button_states2()}catch(n){mc_report_error(22,"")}}function mc_refresh_button_states2(){var i,u,t,s,v,r,c,a,f,l,n,o,e,h;for(mc_apply_rules(),l=mc_get_active_group(),i=0;i<mc_groups.length;i++)for(u=mc_get_group_modules(i),t=0;t<u.length;t++)for(s=mc_module_status[u[t]],i!=l&&(s=9),pr=mc_module_pres[u[t]],r=0;r<pr.length;r++){c=mc_get_pres_status(pr[r]),a=mc_module_codes[u[t]]+"-"+mc_get_pres_code(pr[r])+"-"+mc_get_group_num(i),f=mc_get_element(a,1);if(!f)continue;mc_remove_children(f,0),e=0,mc_is_module_pres_group_in_basket(u[t],mc_get_pres_code(pr[r]),mc_get_group_num(i))==1?e=1:(s==9||c==9||mc_module_editable==0)&&(e=2);if(mc_module_qualpath){if(e==1){n=document.createElement("img"),n.width="18",n.height="19",n.alt="Selected",n.src=mc_img_tick.src,f.appendChild(n);continue}n=document.createElement("button"),n.setAttribute("type","button"),h=document.createElement("span"),h.appendChild(document.createTextNode("Select")),n.appendChild(h),e==2?n.className="select inactive":(n.className="select",n.setAttribute("onclick","mc_select('"+mc_module_codes[u[t]]+"', '"+mc_get_pres_code(pr[r])+"', "+mc_get_group_num(i)+",0)")),f.appendChild(n)}else{n=document.createElement("img"),n.width="67",n.height="20";if(e==1){n.alt="selected",n.src=mc_img_tick.src,f.appendChild(n);continue}if(e==2){n.alt="unavailable",n.src=mc_img_unselect.src,f.appendChild(n);continue}n.alt="select",n.src=mc_img_select.src,o=document.createElement("a"),o.href="javascript:mc_select('"+mc_module_codes[u[t]]+"', '"+mc_get_pres_code(pr[r])+"', "+mc_get_group_num(i)+",0)",o.appendChild(n),f.appendChild(o)}}}function mc_apply_rules(){try{mc_reset_unavailable_modules_and_pres(),mc_update_basket_credits(),mc_recalculate_group_credits();var n=mc_get_active_group();mc_deselect_modules_on_credits(n),mc_deselect_modules_on_study_intensity(),mc_deselect_modules_on_exclusions(n),mc_deselect_presentations_on_study_year(n),mc_deselect_presentations_of_basket_modules()}catch(t){mc_report_error(14,"")}}function mc_report_error(n,t){if(mc_err!=0)return;var i=new Image;i.src="mcp-error.ashx?x="+n+"&y="+t,mc_err=n,t!="xyz"&&alert("Sorry, an unexpected error has just occurred. Please refresh the page and try again.\r\n\r\nThe site administrator has been automatically informed.")}function mc_find_module(n){for(var t=0;t<mc_module_codes.length;t++)if(mc_module_codes[t]==n)return t;return mc_report_error(3,n),-1}function mc_find_pres(n,t){for(var i=0;i<mc_module_pres[n].length;i++)if(mc_get_pres_code(mc_module_pres[n][i])==t)return i;return mc_report_error(4,mc_module_codes[n]+"-"+t),-1}function mc_get_group_index(n){for(var t=0;t<mc_groups.length;t++)if(n==mc_get_group_num(t))return t;return mc_report_error(6,n),-1}function mc_show_friendly_date(n){var i,t;return n=n.toString(),i=n.substr(4,2),i==2&&(t="February "),i==4&&(t="April "),i==10&&(t="October "),t+n.substr(0,4)}function mc_select(n,t,i,r){try{mc_select2(n,t,i,r)}catch(u){mc_report_error(15,n+t)}}function mc_is_module_pres_group_in_basket(n,t,i){var r=mc_get_module_position_in_basket(n);return r>=0&&i==mc_basket_group[r]&&t==mc_basket_pres[r]?1:0}function mc_get_module_position_in_basket(n){for(var t=0;t<mc_basket_size;t++)if(n==mc_basket_modules[t])return t;return-1}function mc_ajax(n){var t=GetHttpObj();if(!t){alert("Sorry, your browser is not supported by this page."),mc_report_error(20,"xyz");return}t.onreadystatechange=function(){t.readyState==4&&t.status==200&&t.responseText!="OK"&&mc_report_error(21,t.responseText)},t.open("GET","action/module-chooser-ajax.ashx?"+mc_module_qualpath+n,!0),t.send(null)}function mc_select2(n,t,i,r){var u,o,f,l,c,e,s,h;u=mc_find_module(n);if(u<0)return;if(r==0&&mc_module_status[u]!=0){mc_report_error(2,n+t);return}if(mc_get_module_position_in_basket(u)>=0){mc_report_error(17,n+t);return}o=mc_find_pres(u,t);if(o<0){mc_report_error(18,n+t);return}f=n+" has been added to your basket.\r\n\r\n",l="&mc="+n+"&mp="+t+"&gr="+i,mc_study_year==0&&(mc_study_year=mc_get_pres_yearstart(mc_module_pres[u][o]),f+="Your study year will start "+mc_show_friendly_date(mc_study_year)+". Any other modules you select must start and complete within this year.\r\n\r\n",l+="&sy="+mc_study_year),r==0&&mc_module_qualpath&&mc_ajax(l),c=mc_get_fee_for_studyyear(mc_module_pres[u][o]),c==0&&mc_report_error(16,n+t),mc_basket_additem(n,t,i,mc_module_credits[u],c,u),mc_refresh_button_states(),mc_basket_misc(),mc_update_basket_remove(),f+="Your study intensity is currently "+mc_basket_credits+" credits. ",mc_basket_credits>=120&&(f+="This is the maximum allowed."),f+="\r\n\r\n",e=mc_get_group_index(i),e>=0&&(s=mc_get_group_mincredits(e),h=mc_get_calc_credits(e),f+=h>=s?"This group is now complete.":"You need "+(s-h)+" more credits to complete this group."),r==0&&alert(f)}function mc_is_module_active(n,t){var r=mc_module_status[n],i;if(r==1||r==2)return 1;for(i=0;i<mc_basket_size;i++)if(n==mc_basket_modules[i]&&t==mc_basket_group[i])return 1;return 0}function mc_recalculate_group_credits(){for(var u,t,r,i,f,n=0;n<mc_groups.length;n++){for(u=mc_get_stud_credits(n),r=mc_get_group_modules(n),t=0;t<r.length;t++)mc_is_module_active(r[t],mc_get_group_num(n))&&(u+=mc_module_credits[r[t]]);mc_set_calc_credits(n,u),f="grpts"+mc_get_group_num(n),i=mc_get_element(f,5),i&&(mc_remove_children(i,0),i.appendChild(document.createTextNode(u)))}}function mc_deselect_modules_on_credits(n){if(n==999)return;for(var u=mc_get_calc_credits(n),r=mc_get_group_mincredits(n),i=mc_get_group_modules(n),t=0;t<i.length;t++){if(mc_module_status[i[t]]!=0)continue;u+mc_module_credits[i[t]]>r&&(mc_module_status[i[t]]=9)}}function mc_deselect_modules_on_exclusions(n){if(n==999)return;var i,u,r,t;i=mc_get_group_exclusions(n);if(i.length==0)return;for(u=mc_get_group_modules(n),r=0;r<u.length;r++){if(!mc_is_module_active(u[r],mc_get_group_num(n)))continue;for(t=0;t<i.length;t++)u[r]==i[t][0]&&mc_deselect_module(i[t][1]),u[r]==i[t][1]&&mc_deselect_module(i[t][0])}}function mc_deselect_module(n){mc_module_status[n]==0&&(mc_module_status[n]=9)}function mc_reset_unavailable_modules_and_pres(){for(var t,n=0;n<mc_module_status.length;n++)mc_module_status[n]==9&&(mc_module_status[n]=0);for(n=0;n<mc_module_pres.length;n++)for(t=0;t<mc_module_pres[n].length;t++)mc_set_pres_status(mc_module_pres[n][t],0)}function mc_update_basket_credits(){mc_basket_credits=0;for(var n=0;n<mc_basket_size;n++)mc_basket_credits+=mc_module_credits[mc_basket_modules[n]]}function mc_deselect_modules_on_study_intensity(){for(var n=0;n<mc_module_status.length;n++)mc_module_status[n]==0&&mc_module_credits[n]+mc_basket_credits>120&&(mc_module_status[n]=9)}function mc_deselect_presentations_on_study_year(n){if(n==999)return;if(mc_study_year==0)return;for(var i,t,f,u=mc_get_group_modules(n),r=0;r<u.length;r++){if(mc_module_status[u[r]]!=0)continue;for(i=mc_module_pres[u[r]],t=0;t<i.length;t++)f=mc_get_pres_yearstart(i[t]),(f<mc_study_year||mc_get_fee_for_studyyear(i[t])==0)&&mc_set_pres_status(i[t],9)}}function mc_remove_children(n,t){while(n.childNodes[t])n.removeChild(n.childNodes[t])}function mc_basket_misc(){var n=mc_get_element("bskstudyyear",7),t;n&&(mc_remove_children(n,0),mc_study_year>0&&n.appendChild(document.createTextNode(mc_show_friendly_date(mc_study_year)))),n=mc_get_element("bskintensity",7),n&&(mc_remove_children(n,0),n.appendChild(document.createTextNode(mc_basket_credits))),n=mc_get_element("bskintenpct",7),n&&(mc_remove_children(n,0),t=mc_basket_credits/120*100,n.appendChild(document.createTextNode(t+"%"))),n=mc_get_element("bskfee",7),n&&(mc_remove_children(n,0),n.appendChild(document.createTextNode("\u00a3"+mc_basket_fee)))}function mc_get_element(n,t){var i=document.getElementById(n);return i||mc_report_error(t,n),i}function mc_basket_additem(n,t,i,r,u,f){if(mc_basket_size==8){mc_report_error(10,n);return}mc_basket_modules[mc_basket_size]=f,mc_basket_pres[mc_basket_size]=t,mc_basket_group[mc_basket_size]=i,mc_basket_size++,mc_basket_fee+=u,mc_module_qualpath?mc_basket_student(n,t,r,i,u):mc_basket_staff(n,t,r,i,u)}function mc_basket_staff(n,t,i,r,u){var a=mc_get_element("bskitems",7),s,c,e,f,o,h,l;if(!a||!a.tBodies)return;s=document.createElement("tr"),e=mc_get_element(n+"-"+r,8),e&&e.childNodes&&(c=e.childNodes[0].nodeValue),f=document.createElement("td"),f.setAttribute("class","c1"),f.appendChild(document.createTextNode(n+" "+c)),s.appendChild(f),f=document.createElement("td"),f.setAttribute("class","c2"),f.appendChild(document.createTextNode(i)),s.appendChild(f),c="",e=mc_get_element(n+"-"+t+"-"+r+"a",9),e&&e.childNodes&&(o=e.childNodes[0].nodeValue,o&&(h=o.indexOf(" "),h>0&&(h++,l=o.indexOf(" ",h),l>0&&(c=o.substr(h,3)+"\u00a0"+o.substr(l+1,4))))),f=document.createElement("td"),f.appendChild(document.createTextNode(c)),s.appendChild(f),f=document.createElement("td"),f.appendChild(document.createTextNode("\u00a3"+u)),s.appendChild(f),a.tBodies[0].appendChild(s),e=mc_get_element("bskdata",7),e&&(e.style.display="block"),e=mc_get_element("bskempty",7),e&&(e.style.display="none")}function mc_basket_student(n,t,i,r,u){var c=mc_get_element("bskitems",7),s,h,f,o,e;if(!c)return;s=document.createElement("div"),s.className="section",f=mc_get_element(n+"-"+r,8),f&&f.childNodes&&(h=f.childNodes[0].nodeValue),f=document.createElement("h3"),f.appendChild(document.createTextNode(h)),s.appendChild(f),o=document.createElement("ul"),h="",f=mc_get_element(n+"-"+t+"-"+r+"a",9),f&&f.childNodes&&(h=f.childNodes[0].nodeValue),e=document.createElement("li"),e.appendChild(document.createTextNode("Starts: "+h)),o.appendChild(e),e=document.createElement("li"),e.appendChild(document.createTextNode(n+", "+i+" credits")),o.appendChild(e),e=document.createElement("li"),e.className="mod-summary-fee",e.appendChild(document.createTextNode("\u00a3"+u)),o.appendChild(e),s.appendChild(o),c.appendChild(s)}function mc_empty_basket(){try{mc_module_qualpath&&mc_ajax("&mc=Z999&mp=2005"),mc_study_year=0,mc_empty_basket2(),mc_basket_misc();var n;mc_module_qualpath||(n=mc_get_element("bskdata",7),n&&(n.style.display="none"),n=mc_get_element("bskempty",7),n&&(n.style.display="block")),n=mc_get_element("bskstudyyear",7),n&&mc_remove_children(n,0)}catch(t){mc_report_error(19,"")}mc_refresh_button_states()}function mc_empty_basket2(){var t,i,n;mc_basket_fee=0,mc_basket_size=0,mc_basket_credits=0,n=mc_get_element("bskitems",7),n&&(mc_module_qualpath?mc_remove_children(n,0):mc_remove_children(n.tBodies[0],1)),n=mc_get_element("bskremove",7),n&&mc_remove_children(n,0)}function mc_update_basket_remove(){var t,u,i,r,n;if(mc_module_editable==0)return;if(mc_basket_size==0){mc_report_error(11,"");return}t=mc_get_element("bskremove",7);if(!t)return;mc_remove_children(t,0),u=document.createElement("a"),u.href="javascript:mc_remove_item()",u.appendChild(document.createTextNode("Remove "+mc_module_codes[mc_basket_modules[mc_basket_size-1]])),mc_basket_size>1&&(i=document.createElement("a"),i.href="javascript:mc_empty_basket()",i.appendChild(document.createTextNode("Remove all"))),mc_module_qualpath?(r=document.createElement("ul"),r.className="mod-remove",n=document.createElement("li"),mc_basket_size>1&&(n.className="mod-remove-mod"),n.appendChild(u),r.appendChild(n),mc_basket_size>1&&(n=document.createElement("li"),n.className="mod-remove-all",n.appendChild(i),r.appendChild(n)),t.appendChild(r)):(t.appendChild(u),mc_basket_size>1&&(t.appendChild(document.createTextNode(" / ")),t.appendChild(i)))}function mc_remove_item(){var t,n;if(mc_basket_size==1){mc_empty_basket();return}mc_module_qualpath&&mc_ajax("&mc=Z999&mp=2000");try{for(t=mc_basket_size-1,mc_empty_basket2(),n=0;n<t;n++)mc_select(mc_module_codes[mc_basket_modules[n]],mc_basket_pres[n],mc_basket_group[n],1)}catch(i){mc_report_error(13,mc_basket_size)}}function mc_rehydrate(){if(typeof window.mc_basket_init=="undefined")return;try{for(var n=0;n<mc_basket_init.length;n++)mc_select(mc_basket_init[n][0],mc_basket_init[n][1],mc_basket_init[n][2],1)}catch(t){mc_report_error(12,mc_basket_init)}}function mc_get_fee_for_studyyear(n){var i,t;if(mc_study_year==0)return 0;for(i=mc_get_pres_studyyears(n),t=0;t<i.length;t++)if(i[t][0]==mc_study_year)return i[t][1];return 0}function mc_deselect_presentations_of_basket_modules(){for(var i,t,n=0;n<mc_basket_size;n++)for(i=mc_module_pres[mc_basket_modules[n]],t=0;t<i.length;t++)mc_set_pres_status(i[t],9)}function mc_warm_ajax(){var n=GetHttpObj();if(!n){alert("Sorry, your browser is not supported by this page."),mc_report_error(20,"xyz");return}n.open("GET","action/module-chooser-ajax.ashx?mc=Z999&mp=9999",!0),n.send(null)}mc_err=0,mc_basket_credits=0,mc_study_year=0,mc_basket_fee=0,mc_basket_pres=["","","","","","","",""],mc_basket_size=0,mc_basket_modules=[0,0,0,0,0,0,0,0],mc_basket_pres=["","","","","","","",""],mc_basket_group=[0,0,0,0,0,0,0,0],mc_img_select=new Image,mc_img_unselect=new Image,mc_img_tick=new Image,mc_init()